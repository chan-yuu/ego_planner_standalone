<launch>
  <!-- Grid Map 参数配置 -->
  <!-- 完全复制原始 ego_planner 的 grid_map 参数 -->
  
  <arg name="map_size_x" default="40.0"/>
  <arg name="map_size_y" default="40.0"/>
  <arg name="map_size_z" default="3.0"/>
  
  <arg name="odometry_topic" default="/odom_world"/>
  <arg name="camera_pose_topic" default="/pcl_render_node/camera_pose"/>
  <arg name="depth_topic" default="/pcl_render_node/depth"/>
  <arg name="cloud_topic" default="/pcl_render_node/cloud"/>
  
  <!-- 相机参数 (仿真环境的默认值) -->
  <arg name="cx" default="321.04638671875"/>
  <arg name="cy" default="243.44969177246094"/>
  <arg name="fx" default="387.229248046875"/>
  <arg name="fy" default="387.229248046875"/>
  
  <node pkg="grid_map_standalone" name="grid_map_node" type="grid_map_node" output="screen">
    <!-- Topic 重映射 -->
    <remap from="/grid_map/odom" to="$(arg odometry_topic)"/>
    <remap from="/grid_map/cloud" to="$(arg cloud_topic)"/>
    <remap from="/grid_map/pose" to="$(arg camera_pose_topic)"/> 
    <remap from="/grid_map/depth" to="$(arg depth_topic)"/>
    
    <!-- 地图基本参数 -->
    <param name="grid_map/resolution" value="0.1"/> 
    <param name="grid_map/map_size_x" value="$(arg map_size_x)"/> 
    <param name="grid_map/map_size_y" value="$(arg map_size_y)"/> 
    <param name="grid_map/map_size_z" value="$(arg map_size_z)"/> 
    <param name="grid_map/local_update_range_x" value="5.5"/> 
    <param name="grid_map/local_update_range_y" value="5.5"/> 
    <param name="grid_map/local_update_range_z" value="4.5"/> 
    <param name="grid_map/obstacles_inflation" value="0.099"/> 
    <param name="grid_map/local_map_margin" value="30"/>
    <param name="grid_map/ground_height" value="-0.01"/>
    
    <!-- 相机参数 -->
    <param name="grid_map/cx" value="$(arg cx)"/>
    <param name="grid_map/cy" value="$(arg cy)"/>
    <param name="grid_map/fx" value="$(arg fx)"/>
    <param name="grid_map/fy" value="$(arg fy)"/>
    
    <!-- 深度过滤 -->
    <param name="grid_map/use_depth_filter" value="true"/>
    <param name="grid_map/depth_filter_tolerance" value="0.15"/>
    <param name="grid_map/depth_filter_maxdist" value="5.0"/>
    <param name="grid_map/depth_filter_mindist" value="0.2"/>
    <param name="grid_map/depth_filter_margin" value="1"/>
    <param name="grid_map/k_depth_scaling_factor" value="1000.0"/>
    <param name="grid_map/skip_pixel" value="2"/>
    
    <!-- 局部融合 (Raycast 概率更新) -->
    <param name="grid_map/p_hit" value="0.65"/>
    <param name="grid_map/p_miss" value="0.35"/>
    <param name="grid_map/p_min" value="0.12"/>
    <param name="grid_map/p_max" value="0.90"/>
    <param name="grid_map/p_occ" value="0.80"/>
    <param name="grid_map/min_ray_length" value="0.1"/>
    <param name="grid_map/max_ray_length" value="4.5"/>
    
    <!-- 可视化 -->
    <param name="grid_map/virtual_ceil_height" value="2.5"/>
    <param name="grid_map/visualization_truncate_height" value="2.4"/>
    <param name="grid_map/show_occ_time" value="false"/>
    <param name="grid_map/pose_type" value="2"/>  <!-- 2 = ODOMETRY -->
    <param name="grid_map/frame_id" value="world"/>
  </node>

</launch>
