# 参数修复说明

**作者**: cyun  
**日期**: 2025-12-05

## 问题描述

独立规划器的避障效果远低于原版ROS系统，经过对比发现参数设置存在严重偏差。

## 参数对比

### 修复前的错误参数

| 参数 | 错误值 | 原版值 | 偏差 |
|------|--------|--------|------|
| `lambda1` (平滑性) | 10.0 | 1.0 | **高10倍** |
| `lambda2` (碰撞避障) | 100.0 | 0.5 | **高200倍** |
| `lambda3` (可行性) | 0.00001 | 0.1 | **低10000倍** |
| `lambda4` (拟合) | 0.01 | 1.0 | **低100倍** |
| `dist0` (安全距离) | 0.3 | 0.5 | 低40% |
| `obstacles_inflation` | 0.3 | 0.099 | **高3倍** |
| `resolution` | 0.2 | 0.1 | 低50% |

### 影响分析

**错误参数的影响：**

1. **lambda2过高（100 vs 0.5）**
   - 碰撞避障权重过大，导致优化器过度关注避障
   - 轨迹变得过于保守，绕行距离过大
   - 可能导致优化陷入局部最优

2. **lambda3过低（0.00001 vs 0.1）**
   - 动力学可行性约束几乎被忽略
   - 可能生成速度/加速度超限的轨迹

3. **lambda4过低（0.01 vs 1.0）**
   - 对原始路径的拟合度降低
   - 轨迹可能偏离预期路径

4. **obstacles_inflation过高（0.3 vs 0.099）**
   - 障碍物膨胀过大（3倍）
   - 可行空间被过度压缩
   - 难以通过狭窄通道

5. **resolution过低（0.2 vs 0.1）**
   - 地图分辨率降低一半
   - 障碍物细节丢失
   - 可能导致碰撞风险

## 修复后的正确参数

```cpp
// 地图参数
params.map_params.resolution_ = 0.1;      // 原版分辨率
params.map_params.obstacles_inflation_ = 0.099;  // 原版膨胀

// 优化器参数 (严格对齐原版)
params.opt_params.lambda1 = 1.0;     // 平滑性权重
params.opt_params.lambda2 = 0.5;     // 碰撞权重
params.opt_params.lambda3 = 0.1;     // 可行性权重
params.opt_params.lambda4 = 1.0;     // 拟合权重
params.opt_params.dist0 = 0.5;       // 安全距离
```

## 其他修复

### 最小高度调整

由于膨胀参数从0.3降低到0.099，相应调整了最小安全高度：

- 起点/终点最小高度：0.5m → **0.2m**
- 采样点最小高度：0.3m → **0.15m**
- 控制点最小高度：0.3m → **0.15m**

### 优化效果预期

修复后应该恢复到原版的优化效果：

1. ✅ **平衡的权重分配**：平滑性、避障、可行性、拟合度的权重比例恢复到1:0.5:0.1:1
2. ✅ **合理的安全距离**：0.5m安全距离 + 0.099m膨胀 = 约0.6m总余量
3. ✅ **精确的地图**：0.1m分辨率提供更细致的障碍物表示
4. ✅ **更优的轨迹**：避障效果好，同时保持平滑和贴近原路径

## 参考文件

- 原版配置：`ego-planner/src/planner/plan_manage/launch/advanced_param.xml`
- 独立版本：`planner_standalone/src/main.cpp` (loadDefaultParams函数)

## 验证方法

1. 编译并运行独立规划器
2. 对比相同场景下的轨迹质量
3. 观察优化收敛速度和成功率
4. 检查轨迹平滑度和避障效果

## 作者信息

已在所有核心文件中添加作者标注：

- `planner_manager.cpp`
- `main.cpp`
- `bspline_optimizer.cpp`

```cpp
/**
 * @author cyun
 */
```
